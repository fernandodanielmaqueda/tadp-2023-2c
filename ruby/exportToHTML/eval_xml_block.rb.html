<html>
<head>
<title>eval_xml_block.rb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #fefff9;}
.s3 { color: #bcbec4;}
.s4 { color: #c77dbb;}
.s5 { color: #74a4c8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
eval_xml_block.rb</font>
</center></td></tr></table>
<pre><span class="s0">class </span><span class="s2">Eval_XML_Block</span>

  <span class="s0">def </span><span class="s3">initialize(document, *xml_block_args, &amp;xml_block)</span>
    <span class="s4">@document </span><span class="s3">= document</span>

    <span class="s3">result = </span><span class="s0">self</span><span class="s3">.instance_exec(*xml_block_args, &amp;xml_block)</span>

    <span class="s4">@document</span><span class="s3">.parent.with_child(result) </span><span class="s0">if </span><span class="s3">result.class != </span><span class="s2">Tag </span><span class="s0">and </span><span class="s4">@document</span><span class="s3">.parent</span>
  <span class="s0">end</span>

  <span class="s0">def </span><span class="s3">method_missing(label, *attributes, &amp;children)</span>

    <span class="s3">tag = </span><span class="s2">Tag</span><span class="s3">.with_label_and_attributes(label, attributes[</span><span class="s5">0</span><span class="s3">])</span>

    <span class="s2">Document</span><span class="s3">.new(tag, &amp;children) </span><span class="s0">if </span><span class="s3">children</span>

    <span class="s0">if </span><span class="s4">@document</span><span class="s3">.parent</span>
      <span class="s4">@document</span><span class="s3">.parent.with_child(tag)</span>
    <span class="s0">else</span>
      <span class="s4">@document</span><span class="s3">.root = tag</span>
    <span class="s0">end</span>

  <span class="s0">end</span>

<span class="s0">end</span></pre>
</body>
</html>